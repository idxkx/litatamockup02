<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LITATA - 衣橱</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "SF Pro Text", -apple, "PingFang SC", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #f8f8f8;
            color: #333;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
        }

        /* iPhone 16 Pro Max 视觉仿真容器 */
        .iphone-container {
            position: relative;
            width: 430px;
            height: 932px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 55px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }

        /* 动态岛 */
        .dynamic-island {
            position: absolute;
            width: 125px;
            height: 35px;
            background: #000;
            border-radius: 20px;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }

        /* 状态栏 */
        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            padding: 10px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 90;
        }

        .status-bar .time {
            font-weight: 600;
            font-size: 16px;
        }

        .status-bar .right {
            display: flex;
            gap: 5px;
        }

        .status-bar .right .icon {
            width: 18px;
            height: 18px;
        }

        /* 主体内容区 */
        .app-container {
            height: 100%;
            width: 100%;
            padding-top: 60px;
            padding-bottom: 85px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* 顶部导航 */
        .wardrobe-header {
            padding: 15px 20px;
            border-bottom: 1px solid #f2f2f2;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #f2f2f2;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
        }

        .scan-btn {
            background-color: #3a7bd5;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .scan-btn svg {
            width: 18px;
            height: 18px;
            fill: #fff;
        }

        /* 分类选项卡 */
        .category-tabs {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none;
            -ms-overflow-style: none;
            margin: 0 -5px;
        }

        .category-tabs::-webkit-scrollbar {
            display: none;
        }

        .tab-item {
            padding: 8px 16px;
            font-size: 14px;
            color: #666;
            position: relative;
        }

        .tab-item.active {
            color: #3a7bd5;
            font-weight: 600;
        }

        .tab-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background-color: #3a7bd5;
            border-radius: 3px;
        }

        /* 内容区域 */
        .wardrobe-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px 20px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .wardrobe-content::-webkit-scrollbar {
            display: none;
        }

        /* 快捷筛选栏 */
        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none;
            padding-bottom: 5px;
        }

        .filter-bar::-webkit-scrollbar {
            display: none;
        }

        .filter-chip {
            padding: 6px 12px;
            background-color: #f2f2f2;
            border-radius: 15px;
            font-size: 13px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-chip.active {
            background-color: #3a7bd5;
            color: #fff;
        }

        /* 搜索栏 */
        .search-bar {
            display: flex;
            height: 40px;
            background-color: #f2f2f2;
            border-radius: 20px;
            padding: 0 15px;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .search-icon {
            color: #999;
            font-size: 16px;
        }

        .search-input {
            flex: 1;
            border: none;
            background: transparent;
            height: 100%;
            font-size: 14px;
            color: #333;
            outline: none;
        }

        /* 子分类标题 */
        .subcategory-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .view-all {
            font-size: 13px;
            color: #3a7bd5;
            font-weight: normal;
            cursor: pointer;
            user-select: none;
        }

        /* 手风琴效果样式 */
        .expanded-content {
            margin-top: 10px;
            border-top: 1px solid #f5f5f5;
            padding-top: 15px;
            overflow: hidden;
            display: none; /* 默认隐藏 */
        }
        
        .expanded-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px dashed #f2f2f2;
        }
        
        /* 展开时的样式变化 */
        .subcategory.expanded .view-all {
            color: #ff7b4e;
            position: relative;
        }
        
        .subcategory.expanded .view-all::after {
            content: '';
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid #ff7b4e;
            margin-left: 5px;
            transform: rotate(180deg);
            transition: transform 0.3s ease;
        }
        
        .subcategory:not(.expanded) .view-all::after {
            content: '';
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid #3a7bd5;
            margin-left: 5px;
            transition: transform 0.3s ease;
        }
        
        /* 展开/收起按钮过渡效果 */
        .view-all {
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 3px;
            cursor: pointer;
            padding: 3px 8px;
            border-radius: 12px;
            background-color: rgba(0,0,0,0.03);
        }
        
        .view-all:hover {
            background-color: rgba(0,0,0,0.05);
        }
        
        /* 展开动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .expanded-content .clothes-item {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* 错开动画延迟 */
        .expanded-content .clothes-item:nth-child(2n) {
            animation-delay: 0.05s;
        }
        
        .expanded-content .clothes-item:nth-child(3n) {
            animation-delay: 0.1s;
        }
        
        .expanded-content .clothes-item:nth-child(4n) {
            animation-delay: 0.15s;
        }
        
        /* 网格大小适配 */
        .clothes-container.grid-small .expanded-grid,
        .expanded-grid.grid-small {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .clothes-container.grid-medium .expanded-grid,
        .expanded-grid.grid-medium {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .clothes-container.grid-large .expanded-grid,
        .expanded-grid.grid-large {
            grid-template-columns: repeat(1, 1fr);
        }

        /* 衣物网格 */
        .clothes-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        /* 状态指示器样式 */
        .item-badge {
            display: none; /* 隐藏所有状态标签 */
        }

        /* 衣物项样式统一 */
        .clothes-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f9f9f9;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .clothes-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .clothes-img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            display: block;
        }

        .item-name {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            padding: 0 3px 5px 3px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 底部导航栏 */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 85px;
            background-color: #fff;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #eee;
            padding-bottom: 20px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .nav-icon {
            width: 28px;
            height: 28px;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-text {
            font-size: 12px;
            color: #666;
        }

        .nav-item.active .nav-icon {
            color: #3a7bd5;
            transform: scale(1.1);
        }

        .nav-item.active .nav-text {
            color: #3a7bd5;
            font-weight: 500;
        }

        /* 底部安全区域 */
        .bottom-safe-area {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20px;
            background-color: #fff;
            z-index: 10;
        }

        /* 添加按钮 */
        .add-item-btn {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            background-color: #3a7bd5;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 50;
        }

        /* 设置模态框和菜单 */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 200;
            display: none;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .settings-modal.show {
            opacity: 1;
        }
        
        .settings-menu {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            max-height: 60%;
            background-color: #f2f2f6;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
            z-index: 210;
            overflow: hidden;
            display: none;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        
        .settings-menu.show {
            transform: translateY(0);
        }
        
        .settings-header {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f2f2f6;
            position: sticky;
            top: 0;
            z-index: 5;
        }
        
        .settings-header:before {
            content: '';
            position: absolute;
            top: 0px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background-color: #d1d1d6;
            border-radius: 2px;
            margin-top: 5px;
        }
        
        .settings-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #111;
        }
        
        .close-settings {
            background: none;
            border: none;
            font-size: 16px;
            color: #007aff;
            cursor: pointer;
            padding: 5px;
        }
        
        .settings-content {
            padding: 0;
            max-height: calc(60% - 50px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .settings-item {
            margin-bottom: 10px;
            background-color: #fff;
        }
        
        .settings-item-title {
            font-size: 14px;
            font-weight: 600;
            padding: 8px 15px;
            margin: 0;
            color: #8E8E93;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background-color: #f2f2f6;
        }
        
        .settings-item-options {
            display: flex;
            flex-direction: column;
        }
        
        .settings-option {
            padding: 12px 15px;
            color: #000;
            font-size: 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            background-color: #fff;
        }
        
        .settings-option:last-child {
            border-bottom: none;
        }
        
        .settings-option:after {
            content: '›';
            font-size: 20px;
            color: #bbb;
            font-weight: 300;
        }
        
        /* 相机模态框 */
        .camera-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 200;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .camera-modal.show {
            opacity: 1;
        }
        
        .camera-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 5;
        }
        
        .camera-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }
        
        .close-camera {
            background: none;
            border: none;
            font-size: 24px;
            color: #fff;
            cursor: pointer;
            padding: 5px;
        }
        
        .camera-viewfinder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .camera-placeholder {
            text-align: center;
            color: #fff;
        }
        
        .camera-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        #cameraView {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-controls {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        #startCameraBtn {
            padding: 12px 25px;
            background-color: #fff;
            color: #000;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .camera-capture-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            border: 4px solid #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .capture-icon {
            width: 30px;
            height: 30px;
            background-color: #fff;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="iphone-container">
        <!-- 动态岛 -->
        <div class="dynamic-island"></div>
        
        <!-- 状态栏 -->
        <div class="status-bar">
            <div class="time">10:30</div>
            <div class="right">
                <div class="icon">📶</div>
                <div class="icon">📡</div>
                <div class="icon">🔋</div>
            </div>
        </div>

        <!-- 应用主内容 -->
        <div class="app-container">
            <!-- 顶部导航 -->
            <div class="wardrobe-header">
                <div class="header-row">
                    <h1 class="page-title">衣橱</h1>
                    <div class="action-buttons">
                        <button class="action-btn scan-btn" id="scanBtn">
                            📷
                        </button>
                        <button class="action-btn settings-icon" id="settingsBtn">
                            ⚙️
                        </button>
                    </div>
                </div>
                
                <!-- 分类选项卡 -->
                <div class="category-tabs">
                    <div class="tab-item active">全部</div>
                    <div class="tab-item">上装</div>
                    <div class="tab-item">下装</div>
                    <div class="tab-item">连体服饰</div>
                    <div class="tab-item">鞋靴</div>
                    <div class="tab-item">配饰</div>
                    <div class="tab-item">功能服饰</div>
                    <div class="tab-item">特殊场景</div>
                </div>
            </div>
            
            <!-- 内容区域 -->
            <div class="wardrobe-content">
                <!-- 快捷筛选栏 -->
                <div class="filter-bar">
                    <div class="filter-chip active">全部季节</div>
                    <div class="filter-chip">春季</div>
                    <div class="filter-chip">夏季</div>
                    <div class="filter-chip">秋季</div>
                    <div class="filter-chip">冬季</div>
                    <div class="filter-chip">场景筛选</div>
                    <div class="filter-chip">清洁状态</div>
                </div>
                
                <!-- 搜索栏 -->
                <div class="search-bar">
                    <div class="search-icon">🔍</div>
                    <input type="text" placeholder="搜索衣物" class="search-input">
                </div>
                
                <!-- 上装-基础款 -->
                <div class="subcategory">
                    <div class="subcategory-title">
                        上装 - 基础款
                        <span class="view-all">查看全部 ></span>
                    </div>
                    
                    <div class="clothes-grid clothes-container">
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?q=80&w=380&auto=format&fit=crop" alt="T恤衫" class="clothes-img">
                            <div class="item-badge unworn">未穿着</div>
                            <div class="item-name">T恤衫</div>
                        </div>
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1542272604-787c3835535d?q=80&w=387&auto=format&fit=crop" alt="牛仔裤" class="clothes-img">
                            <div class="item-badge">已穿着</div>
                            <div class="item-name">牛仔裤</div>
                        </div>
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1596755094514-f87e34085b2c?q=80&w=388&auto=format&fit=crop" alt="衬衫" class="clothes-img">
                            <div class="item-badge">已穿着</div>
                            <div class="item-name">衬衫</div>
                        </div>
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1550639525-c97d455acf70?q=80&w=387&auto=format&fit=crop" alt="连衣裙" class="clothes-img">
                            <div class="item-badge">已穿着</div>
                            <div class="item-name">连衣裙</div>
                        </div>
                    </div>
                </div>
                
                <!-- 上装-外套 -->
                <div class="subcategory">
                    <div class="subcategory-title">
                        上装 - 外套
                        <span class="view-all">查看全部 ></span>
                    </div>
                    
                    <div class="clothes-grid">
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1611312449408-fcece27cdbb7?q=80&w=369&auto=format&fit=crop" class="clothes-img" alt="牛仔外套">
                            <div class="item-name">深蓝色牛仔外套</div>
                        </div>
                        
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1591047139829-d91aecb6caea?q=80&w=436&auto=format&fit=crop" class="clothes-img" alt="西装外套">
                            <div class="item-badge">已穿着</div>
                            <div class="item-name">灰色西装外套</div>
                        </div>
                        
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1543076447-215ad9ba6923?q=80&w=1374&auto=format&fit=crop" class="clothes-img" alt="黑色皮夹克">
                            <div class="item-name">黑色皮夹克</div>
                        </div>
                        
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1584865288642-42078afe6942?q=80&w=387&auto=format&fit=crop" class="clothes-img" alt="格子大衣">
                            <div class="item-badge idle">闲置</div>
                            <div class="item-name">驼色格子大衣</div>
                        </div>
                    </div>
                </div>
                
                <!-- 下装-裤装 -->
                <div class="subcategory">
                    <div class="subcategory-title">
                        下装 - 裤装
                        <span class="view-all">查看全部 ></span>
                    </div>
                    
                    <div class="clothes-grid">
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1541099649105-f69ad21f3246?q=80&w=387&auto=format&fit=crop" class="clothes-img" alt="牛仔裤">
                            <div class="item-badge">已穿着</div>
                            <div class="item-name">蓝色直筒牛仔裤</div>
                        </div>
                        
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?q=80&w=387&auto=format&fit=crop" class="clothes-img" alt="休闲裤">
                            <div class="item-name">米色休闲裤</div>
                        </div>
                        
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1473966968600-fa801b869a1a?q=80&w=387&auto=format&fit=crop" class="clothes-img" alt="运动裤">
                            <div class="item-name">黑色运动裤</div>
                        </div>
                        
                        <div class="clothes-item">
                            <img src="https://images.unsplash.com/photo-1584865288642-42078afe6942?q=80&w=387&auto=format&fit=crop" class="clothes-img" alt="西装裤">
                            <div class="item-name">灰色西装裤</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 添加衣物按钮 -->
            <div class="add-item-btn">+</div>
            
            <!-- 底部导航栏 -->
            <div class="bottom-nav">
                <div class="nav-item">
                    <div class="nav-icon">🏠</div>
                    <div class="nav-text">首页</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">✨</div>
                    <div class="nav-text">穿搭</div>
                </div>
                <div class="nav-item active">
                    <div class="nav-icon">👚</div>
                    <div class="nav-text">衣橱</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">👤</div>
                    <div class="nav-text">我的</div>
                </div>
            </div>
            
            <!-- 底部安全区域 -->
            <div class="bottom-safe-area"></div>
        </div>
    </div>

    <!-- 设置模态框和菜单 -->
    <div class="settings-modal">
        <div class="settings-menu">
            <div class="settings-header">
                <div></div>
                <h3>设置</h3>
                <button class="close-settings">✕</button>
            </div>
            <div class="settings-content">
                <div class="settings-item">
                    <div class="settings-item-title">外观</div>
                    <div class="settings-item-options">
                        <div class="settings-option" data-setting="grid-size">
                            <span>网格大小</span>
                        </div>
                        <div class="settings-option" data-setting="theme">
                            <span>主题</span>
                        </div>
                    </div>
                </div>
                <div class="settings-item">
                    <div class="settings-item-title">管理</div>
                    <div class="settings-item-options">
                        <div class="settings-option" data-setting="categories">
                            <span>分类管理</span>
                        </div>
                        <div class="settings-option" data-setting="tags">
                            <span>标签管理</span>
                        </div>
                    </div>
                </div>
                <div class="settings-item">
                    <div class="settings-item-title">数据</div>
                    <div class="settings-item-options">
                        <div class="settings-option" data-setting="backup">
                            <span>备份数据</span>
                        </div>
                        <div class="settings-option" data-setting="import">
                            <span>导入数据</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 相机模态框 -->
    <div class="camera-modal">
        <div class="camera-header">
            <button class="close-camera">✕</button>
            <h3>拍照搜索</h3>
            <div></div>
        </div>
        <div class="camera-viewfinder">
            <div class="camera-placeholder">
                <div class="camera-icon">📷</div>
                <p>点击下方按钮开启相机</p>
            </div>
            <video id="cameraView" autoplay playsinline style="display: none;"></video>
        </div>
        <div class="camera-controls">
            <button class="camera-btn" id="startCameraBtn">开启相机</button>
            <button class="camera-capture-btn" id="captureBtn" style="display: none;">
                <div class="capture-icon"></div>
            </button>
        </div>
    </div>

    <script>
        // 执行页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面已加载完成');
            
            // 首先初始化衣物的数据属性
            initClothesItemsAttributes();
            
            // 处理导航栏点击
            setupNavigation();
            
            // 初始化分类滑块
            initCategorySlider();
            
            // 添加购物车功能
            setupShoppingCart();
            
            // 设置筛选栏
            initFilterBar();
            
            // 初始化"查看全部"按钮
            initViewAllButtons();
            
            // 初始化衣物悬停效果
            initClothesItemHover();
            
            // 初始化衣物点击事件
            initClothesItemClick();
            
            // 添加设置按钮点击处理
            document.querySelector('#settingsBtn').addEventListener('click', handleSettingsClick);
            
            // 添加扫描按钮点击处理
            document.querySelector('#scanBtn').addEventListener('click', handleScanClick);
            
            // 关闭设置菜单按钮
            document.querySelector('.close-settings').addEventListener('click', closeSettingsMenu);
            
            // 关闭相机模态框按钮
            document.querySelector('.close-camera').addEventListener('click', closeCameraModal);
            
            // 开启相机按钮
            document.querySelector('#startCameraBtn').addEventListener('click', startCamera);
            
            // 拍照按钮
            document.querySelector('#captureBtn').addEventListener('click', capturePhoto);
            
            // 初始化设置功能
            initializeSettingsFeatures();
            
            // 初始化添加按钮
            document.querySelector('.add-item-btn').addEventListener('click', function() {
                showToast('添加衣物功能尚未实现');
            });
            
            // 初始化拖放功能
            initializeOrganizerBar();
            makeItemsDraggable();
        });
        
        // 扫描按钮点击处理函数
        function handleScanClick() {
            showToast('打开相机扫描');
            
            // 显示相机模态框
            const cameraModal = document.querySelector('.camera-modal');
            if (cameraModal) {
                cameraModal.style.display = 'block';
                // 触发重绘以启用过渡效果
                void cameraModal.offsetWidth;
                cameraModal.classList.add('show');
            }
            
            // 添加iOS风格触感反馈
            if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(5);
            }
        }
        
        // 关闭相机模态框
        function closeCameraModal() {
            const cameraModal = document.querySelector('.camera-modal');
            if (cameraModal) {
                cameraModal.classList.remove('show');
                
                // 等待过渡效果完成后隐藏元素
                setTimeout(() => {
                    cameraModal.style.display = 'none';
                    
                    // 停止相机
                    stopCamera();
                }, 300);
            }
        }
        
        // 开启相机
        function startCamera() {
            const cameraView = document.getElementById('cameraView');
            const startBtn = document.getElementById('startCameraBtn');
            const captureBtn = document.getElementById('captureBtn');
            const placeholder = document.querySelector('.camera-placeholder');
            
            // 检查浏览器是否支持getUserMedia
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(function(stream) {
                        // 显示视频流
                        cameraView.srcObject = stream;
                        cameraView.style.display = 'block';
                        
                        // 隐藏开始按钮，显示拍照按钮
                        startBtn.style.display = 'none';
                        captureBtn.style.display = 'block';
                        
                        // 隐藏占位符
                        placeholder.style.display = 'none';
                        
                        showToast('相机已开启');
                    })
                    .catch(function(error) {
                        console.error('相机开启失败:', error);
                        showToast('无法开启相机: ' + error.message);
                    });
            } else {
                showToast('您的浏览器不支持相机功能');
            }
        }
        
        // 停止相机
        function stopCamera() {
            const cameraView = document.getElementById('cameraView');
            const startBtn = document.getElementById('startCameraBtn');
            const captureBtn = document.getElementById('captureBtn');
            const placeholder = document.querySelector('.camera-placeholder');
            
            // 停止视频流
            if (cameraView.srcObject) {
                const tracks = cameraView.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                cameraView.srcObject = null;
            }
            
            // 重置UI
            cameraView.style.display = 'none';
            startBtn.style.display = 'block';
            captureBtn.style.display = 'none';
            placeholder.style.display = 'block';
        }
        
        // 拍照并识别
        function capturePhoto() {
            const cameraView = document.getElementById('cameraView');
            
            // 创建画布捕获视频当前帧
            const canvas = document.createElement('canvas');
            canvas.width = cameraView.videoWidth;
            canvas.height = cameraView.videoHeight;
            
            const context = canvas.getContext('2d');
            context.drawImage(cameraView, 0, 0, canvas.width, canvas.height);
            
            // 获取图片数据
            const imageData = canvas.toDataURL('image/jpeg');
            
            // 在实际应用中，这里应该发送图片到服务器或本地AI处理
            // 模拟识别过程
            showToast('正在识别图片...');
            
            // 关闭相机模态框
            closeCameraModal();
            
            // 模拟一个延时，假装在识别
            setTimeout(() => {
                // 随机选择一个识别结果
                const results = [
                    '牛仔裤',
                    'T恤',
                    '连衣裙',
                    '皮夹克'
                ];
                const result = results[Math.floor(Math.random() * results.length)];
                
                showToast(`识别结果: ${result}，正在搜索相似衣物...`);
                
                // 模拟搜索过程
                setTimeout(() => {
                    showToast(`已找到5件相似的${result}`);
                    
                    // 这里可以实现搜索结果展示逻辑
                }, 1000);
            }, 1500);
        }

        // 网格大小调整功能变量与设置
        let gridSizeOptions = [
            { name: '小', value: 'small', columns: 3 },
            { name: '中', value: 'medium', columns: 2 },
            { name: '大', value: 'large', columns: 1 }
        ];
        let currentGridSize = localStorage.getItem('wardrobeGridSize') || 'medium';
        
        // 全局变量，用于记录当前筛选状态
        let currentCategory = '全部';
        let currentSeason = '全部季节';
        let currentScene = '日常';
        
        // 初始化设置项
        function initializeSettingsFeatures() {
            // 首先初始化原有的设置菜单关闭功能
            initializeSettingsMenu();
            
            // 然后初始化各个设置功能
            initializeGridSizeSettings();
        }
        
        // 初始化网格大小设置
        function initializeGridSizeSettings() {
            // 找到网格大小设置选项
            const gridSizeOption = document.querySelector('.settings-option');
            
            if (gridSizeOption) {
                gridSizeOption.addEventListener('click', function() {
                    showGridSizeMenu();
                });
                
                // 应用保存的网格大小设置
                applyGridSizeSettings(currentGridSize);
            }
        }
        
        // 显示网格大小设置菜单
        function showGridSizeMenu() {
            // 关闭当前的设置菜单
            const settingsModal = document.querySelector('.settings-modal');
            const settingsMenu = document.querySelector('.settings-menu');
            settingsMenu.classList.remove('show');
            
            // 创建网格大小设置子菜单
            const gridSizeSubMenu = document.createElement('div');
            gridSizeSubMenu.className = 'settings-submenu';
            gridSizeSubMenu.innerHTML = `
                <div class="settings-header">
                    <div class="back-button">
                        <span>←</span>
                    </div>
                    <h3>网格大小</h3>
                    <div></div>
                </div>
                <div class="settings-content">
                    <div class="settings-item">
                        <div class="settings-item-options">
                            ${gridSizeOptions.map(option => `
                                <div class="settings-option grid-size-option" data-size="${option.value}">
                                    <div class="option-left">
                                        <span class="grid-preview grid-${option.value}"></span>
                                        <span>${option.name}</span>
                                    </div>
                                    <span class="option-check ${currentGridSize === option.value ? 'checked' : ''}">✓</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            settingsModal.appendChild(gridSizeSubMenu);
            
            // 显示子菜单
            setTimeout(() => {
                gridSizeSubMenu.classList.add('show');
                
                // 添加返回按钮事件
                const backButton = gridSizeSubMenu.querySelector('.back-button');
                backButton.addEventListener('click', function() {
                    hideSubmenu(gridSizeSubMenu);
                });
                
                // 添加网格大小选项点击事件
                const gridOptions = gridSizeSubMenu.querySelectorAll('.grid-size-option');
                gridOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const size = this.getAttribute('data-size');
                        // 更新选中状态
                        gridSizeSubMenu.querySelectorAll('.option-check').forEach(check => {
                            check.classList.remove('checked');
                        });
                        this.querySelector('.option-check').classList.add('checked');
                        
                        // 保存设置
                        localStorage.setItem('wardrobeGridSize', size);
                        currentGridSize = size;
                        
                        // 应用设置
                        applyGridSizeSettings(size);
                        
                        // 显示成功提示
                        showToast('网格大小已更新');
                        
                        // 延迟关闭子菜单
                        setTimeout(() => {
                            hideSubmenu(gridSizeSubMenu);
                        }, 500);
                    });
                });
            }, 50);
        }
        
        // 隐藏子菜单
        function hideSubmenu(submenu) {
            submenu.classList.remove('show');
            
            // 显示主设置菜单
            const settingsMenu = document.querySelector('.settings-menu');
            settingsMenu.classList.add('show');
            
            // 移除子菜单
            setTimeout(() => {
                if (submenu.parentNode) {
                    submenu.parentNode.removeChild(submenu);
                }
            }, 300);
        }
        
        // 应用网格大小设置
        function applyGridSizeSettings(size) {
            const clothesContainer = document.querySelector('.clothes-grid');
            
            if (clothesContainer) {
                // 移除现有的网格类
                clothesContainer.classList.remove('grid-small', 'grid-medium', 'grid-large');
                
                // 添加新的网格类
                clothesContainer.classList.add(`grid-${size}`);
                
                // 重新排列衣物布局
                adjustClothesLayout();
            }
        }
        
        // 调整衣物布局
        function adjustClothesLayout() {
            const clothesItems = document.querySelectorAll('.clothes-item');
            
            // 根据当前网格大小设置，调整衣物显示
            const selectedOption = gridSizeOptions.find(option => option.value === currentGridSize);
            if (selectedOption) {
                clothesItems.forEach(item => {
                    item.style.width = `calc(${100/selectedOption.columns}% - 10px)`;
                });
            }
        }
        
        // 设置按钮点击处理函数
        function handleSettingsClick() {
            showToast('打开设置菜单');
            console.log('设置按钮被点击');
            
            // 显示设置菜单
            const settingsModal = document.querySelector('.settings-modal');
            const settingsMenu = document.querySelector('.settings-menu');
            
            if (settingsModal && settingsMenu) {
                // 首先显示模态背景
                settingsModal.style.display = 'block';
                // 触发重绘以启用过渡效果
                void settingsModal.offsetWidth;
                settingsModal.classList.add('show');
                
                // 然后显示设置菜单（从底部滑入）
                settingsMenu.style.display = 'block';
                // 触发重绘以启用过渡效果
                void settingsMenu.offsetWidth;
                settingsMenu.classList.add('show');
            }
            
            // 添加iOS风格触感反馈
            if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(5);
            }
        }
        
        // 初始化设置菜单关闭按钮
        function initializeSettingsMenu() {
            const closeSettingsBtn = document.querySelector('.close-settings');
            const settingsModal = document.querySelector('.settings-modal');
            const settingsMenu = document.querySelector('.settings-menu');
            
            if (closeSettingsBtn && settingsModal) {
                closeSettingsBtn.addEventListener('click', closeSettingsMenu);
                
                // 点击模态背景关闭设置
                settingsModal.addEventListener('click', function(e) {
                    if (e.target === settingsModal) {
                        closeSettingsMenu();
                    }
                });
                
                // 添加手势滑动关闭功能
                if (settingsMenu) {
                    let startY = 0;
                    let currentY = 0;
                    
                    settingsMenu.addEventListener('touchstart', function(e) {
                        startY = e.touches[0].clientY;
                    });
                    
                    settingsMenu.addEventListener('touchmove', function(e) {
                        currentY = e.touches[0].clientY;
                        const diffY = currentY - startY;
                        
                        // 只允许向下滑动关闭
                        if (diffY > 0) {
                            this.style.transform = `translateY(${diffY}px)`;
                            e.preventDefault(); // 防止页面滚动
                        }
                    });
                    
                    settingsMenu.addEventListener('touchend', function() {
                        const diffY = currentY - startY;
                        if (diffY > 70) { // 如果下滑超过70px则关闭
                            closeSettingsMenu();
                        } else {
                            // 否则恢复原位
                            this.style.transform = '';
                            this.classList.add('show');
                        }
                    });
                }
                
                // 设置选项点击效果
                const settingsOptions = document.querySelectorAll('.settings-option');
                settingsOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const optionText = this.textContent.trim();
                        showToast(`您选择了: ${optionText}`);
                        
                        // 添加点击反馈
                        this.style.backgroundColor = 'rgba(0,0,0,0.05)';
                        setTimeout(() => {
                            this.style.backgroundColor = '';
                        }, 200);
                        
                        // 添加iOS风格触感反馈
                        if (window.navigator && window.navigator.vibrate) {
                            window.navigator.vibrate(3);
                        }
                    });
                });
            }
        }
        
        // 关闭设置菜单函数
        function closeSettingsMenu() {
            const settingsModal = document.querySelector('.settings-modal');
            const settingsMenu = document.querySelector('.settings-menu');
            
            if (settingsModal && settingsMenu) {
                // 先移除show类以触发过渡效果
                settingsModal.classList.remove('show');
                settingsMenu.classList.remove('show');
                
                // 重置可能存在的内联样式
                settingsMenu.style.transform = 'translateY(100%)';
                
                // 等待过渡效果完成后隐藏元素
                setTimeout(() => {
                    settingsModal.style.display = 'none';
                    settingsMenu.style.display = 'none';
                    // 恢复默认状态
                    settingsMenu.style.transform = '';
                }, 400); // 略长于CSS过渡时间
            }
        }
        
        // 显示提示消息
        function showToast(message) {
            // 检查是否已有toast，如果有则移除
            const existingToast = document.querySelector('.toast-message');
            if (existingToast) {
                document.body.removeChild(existingToast);
            }
            
            // 创建新的toast元素
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.textContent = message;
            
            // 添加toast样式
            toast.style.position = 'fixed';
            toast.style.bottom = '100px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            toast.style.color = 'white';
            toast.style.padding = '10px 20px';
            toast.style.borderRadius = '20px';
            toast.style.zIndex = '1000';
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.3s ease';
            
            // 将toast添加到页面中
            document.body.appendChild(toast);
            
            // 触发重绘以启用过渡效果
            void toast.offsetWidth;
            toast.style.opacity = '1';
            
            // 设置自动消失的定时器
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 2000);
        }
        
        // 导航功能
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach((item, index) => {
                item.addEventListener('click', function() {
                    // 移除其他项目的active类
                    navItems.forEach(navItem => navItem.classList.remove('active'));
                    // 给当前项目添加active类
                    this.classList.add('active');
                    
                    // 导航到相应页面
                    switch(index) {
                        case 0:
                            // 首页
                            showToast('导航到首页');
                            window.location.href = 'index.html';
                            break;
                        case 1:
                            // 衣橱
                            showToast('导航到衣橱');
                            window.location.href = 'wardrobe.html';
                            break;
                        case 2:
                            // 穿搭
                            showToast('导航到穿搭');
                            window.location.href = 'outfit.html';
                            break;
                        case 3:
                            // 我的
                            showToast('导航到我的');
                            window.location.href = 'profile.html';
                            break;
                    }
                });
            });
        }

        // 初始化分类滑块
        function initCategorySlider() {
            const tabs = document.querySelectorAll('.category-tabs .tab-item');
            console.log(`找到 ${tabs.length} 个分类标签，文本内容:`, Array.from(tabs).map(t => t.textContent.trim()));
            
            tabs.forEach((tab, index) => {
                tab.addEventListener('click', function() {
                    // 移除其他标签的active类
                    tabs.forEach(t => t.classList.remove('active'));
                    // 给当前标签添加active类
                    this.classList.add('active');
                    
                    const category = this.textContent.trim();
                    console.log(`点击分类标签: "${category}", 索引: ${index}`);
                    showToast(`已切换到${category}分类`);
                    
                    // 筛选相关衣物和子分类
                    filterByCategory(category);
                });
            });
        }
        
        // 初始化衣物数据属性
        function initClothesItemsAttributes() {
            console.log('正在初始化衣物数据属性');
            
            // 获取所有子分类
            const subcategories = document.querySelectorAll('.subcategory');
            console.log(`找到 ${subcategories.length} 个子分类`);
            
            // 遍历所有子分类，为衣物设置属性
            subcategories.forEach((subcat, index) => {
                const titleEl = subcat.querySelector('.subcategory-title');
                if (!titleEl) {
                    console.log(`子分类 ${index} 没有标题元素`);
                    return;
                }
                
                // 直接获取子分类标题文本，例如"上装 - 基础款"
                const titleText = titleEl.textContent.trim().split('>')[0].trim();
                console.log(`处理子分类: "${titleText}"`);
                
                // 提取主要分类，例如"上装" 和子分类 "基础款"
                const parts = titleText.split('-').map(part => part.trim());
                if (parts.length < 2) {
                    console.log(`子分类标题 "${titleText}" 格式不符合"分类-类型"格式`);
                    return;
                }
                
                const mainCategory = parts[0]; // 例如"上装"
                const subcategoryType = parts[1]; // 例如"基础款"
                
                console.log(`提取分类: 主分类="${mainCategory}", 子分类="${subcategoryType}"`);
                
                // 获取该子分类下所有衣物
                const items = subcat.querySelectorAll('.clothes-item');
                console.log(`子分类 "${titleText}" 下有 ${items.length} 件衣物`);
                
                // 为每件衣物设置数据属性
                items.forEach(item => {
                    const nameEl = item.querySelector('.item-name');
                    const name = nameEl ? nameEl.textContent.trim() : '未命名';
                    
                    // 设置主分类和子分类
                    item.setAttribute('data-category', mainCategory);
                    item.setAttribute('data-subcategory', subcategoryType);
                    
                    // 根据名称设置季节
                    let seasons = [];
                    if (name.includes('春') || name.toLowerCase().includes('spring')) seasons.push('春季');
                    if (name.includes('夏') || name.toLowerCase().includes('summer')) seasons.push('夏季');
                    if (name.includes('秋') || name.toLowerCase().includes('fall') || name.toLowerCase().includes('autumn')) seasons.push('秋季');
                    if (name.includes('冬') || name.toLowerCase().includes('winter')) seasons.push('冬季');
                    
                    // 如果没有明确的季节，根据衣物类型推断
                    if (seasons.length === 0) {
                        if (name.includes('T恤') || name.includes('短袖') || name.includes('短裤')) {
                            seasons.push('夏季');
                        } else if (name.includes('毛衣') || name.includes('大衣') || name.includes('羽绒')) {
                            seasons.push('冬季');
                        } else if (name.includes('风衣') || name.includes('夹克')) {
                            seasons.push('春季', '秋季');
                        } else {
                            seasons.push('春季', '夏季', '秋季', '冬季'); // 默认全季节
                        }
                    }
                    
                    item.setAttribute('data-season', seasons.join(','));
                    
                    // 根据名称设置场景
                    let scenes = [];
                    if (name.includes('休闲') || name.includes('日常')) scenes.push('日常', '休闲');
                    if (name.includes('正装') || name.includes('西装') || name.includes('西服')) scenes.push('正式', '职场');
                    if (name.includes('运动')) scenes.push('运动');
                    if (name.includes('派对') || name.includes('约会')) scenes.push('约会');
                    
                    // 如果没有明确的场景，根据衣物类型推断
                    if (scenes.length === 0) {
                        if (subcategoryType.includes('基础') || name.includes('T恤')) {
                            scenes.push('日常', '休闲');
                        } else if (name.includes('外套') || name.includes('西装')) {
                            scenes.push('职场', '正式');
                        } else {
                            scenes.push('日常'); // 默认日常场景
                        }
                    }
                    
                    item.setAttribute('data-scene', scenes.join(','));
                    
                    console.log(`衣物 "${name}" - 分类:${mainCategory}, 子分类:${subcategoryType}, 季节:${seasons.join(',')}, 场景:${scenes.join(',')}`);
                });
            });
            
            // 调试输出：统计各个分类的衣物数量
            setTimeout(() => {
                const allItems = document.querySelectorAll('.clothes-item');
                const categoryCounts = {};
                
                allItems.forEach(item => {
                    const cat = item.getAttribute('data-category');
                    categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
                });
                
                console.log('分类统计:', categoryCounts);
                
                // 特别检查"上装"分类
                const topsItems = Array.from(allItems).filter(item => 
                    item.getAttribute('data-category') === '上装');
                console.log(`"上装"分类共有 ${topsItems.length} 件衣物:`, 
                    topsItems.map(item => item.querySelector('.item-name')?.textContent || '未命名'));
            }, 100);
            
            console.log('衣物数据属性初始化完成');
        }
        
        // 组合筛选（同时考虑分类、季节和场景）
        function applyFilters() {
            console.log(`应用筛选 - 分类:"${currentCategory}", 季节:"${currentSeason}", 场景:"${currentScene}"`);
            
            const clothesItems = document.querySelectorAll('.clothes-item');
            console.log(`找到 ${clothesItems.length} 个衣物项`);
            
            // 更灵活的分类匹配函数
            function categoryMatches(itemCategory, selectedCategory) {
                if (selectedCategory === '全部') return true;
                if (!itemCategory) return false;
                
                // 精确匹配
                if (itemCategory === selectedCategory) return true;
                
                // 部分匹配（处理可能的空格或其他差异）
                const normalizedItem = itemCategory.replace(/\s+/g, '');
                const normalizedSelected = selectedCategory.replace(/\s+/g, '');
                
                return normalizedItem === normalizedSelected;
            }
            
            // 根据当前选中的分类、季节和场景进行筛选
            let visibleCount = 0;
            clothesItems.forEach(item => {
                const itemCategory = item.getAttribute('data-category');
                const itemSeasons = item.getAttribute('data-season') || '';
                const itemScenes = item.getAttribute('data-scene') || '';
                const name = item.querySelector('.item-name')?.textContent || '未命名';
                
                const matchesCategory = categoryMatches(itemCategory, currentCategory);
                const matchesSeason = currentSeason === '全部季节' || itemSeasons.includes(currentSeason);
                const matchesScene = !currentScene || currentScene === '日常' || itemScenes.includes(currentScene);
                
                // 输出筛选详情
                if (!matchesCategory) {
                    console.log(`衣物 "${name}" 分类不匹配 - 衣物:"${itemCategory}", 选中:"${currentCategory}"`);
                }
                
                if (matchesCategory && matchesSeason && matchesScene) {
                    item.style.display = '';
                    visibleCount++;
                    console.log(`显示衣物: "${name}", 分类="${itemCategory}"`);
                } else {
                    item.style.display = 'none';
                }
            });
            
            console.log(`筛选结果: 显示 ${visibleCount}/${clothesItems.length} 个衣物`);
            
            // 处理子分类的显示/隐藏
            const subcategories = document.querySelectorAll('.subcategory');
            subcategories.forEach(subcat => {
                const titleEl = subcat.querySelector('.subcategory-title');
                if (!titleEl) return;
                
                const titleText = titleEl.textContent.trim().split('>')[0].trim();
                const parts = titleText.split('-').map(part => part.trim());
                if (parts.length < 2) return;
                
                const subcatCategory = parts[0]; // 例如"上装"
                
                // 检查是否有可见的衣物
                const visibleItems = Array.from(subcat.querySelectorAll('.clothes-item')).filter(
                    item => item.style.display !== 'none'
                );
                
                const hasVisibleItems = visibleItems.length > 0;
                
                // 更灵活的子分类匹配
                const matchesCategory = categoryMatches(subcatCategory, currentCategory);
                
                if ((currentCategory === '全部' || matchesCategory) && hasVisibleItems) {
                    subcat.style.display = '';
                    console.log(`显示子分类: "${titleText}", 分类="${subcatCategory}", 匹配=${matchesCategory}`);
                } else {
                    subcat.style.display = 'none';
                    console.log(`隐藏子分类: "${titleText}", 分类="${subcatCategory}", 匹配=${matchesCategory}, 有可见衣物=${hasVisibleItems}`);
                }
            });
            
            // 处理没有结果的情况
            if (visibleCount === 0) {
                console.log('筛选结果为空，没有匹配的衣物');
                showToast('没有符合条件的衣物');
            }
        }
        
        // 按分类筛选衣物
        function filterByCategory(category) {
            console.log(`执行分类筛选: "${category}"`);
            
            // 更新当前选中的分类
            currentCategory = category;
            
            // 调用组合筛选
            applyFilters();
        }
        
        // 按季节筛选衣物
        function filterBySeason(season) {
            // 更新当前选中的季节
            currentSeason = season;
            
            // 调用组合筛选
            applyFilters();
        }
        
        // 按场景筛选衣物
        function filterByScene(scene) {
            // 更新当前选中的场景
            currentScene = scene;
            
            // 调用组合筛选
            applyFilters();
        }

        // 初始化模拟数据
        function initializeWardrobeData() {
            // 这里可以添加模拟数据的初始化逻辑
        }

        // 整理栏相关功能
        function initializeOrganizerBar() {
            // 这里可以添加整理栏的初始化逻辑
        }

        // 拖拽功能
        function makeItemsDraggable() {
            // 这里可以添加拖拽功能的初始化逻辑
        }

        // 初始化筛选栏
        function initFilterBar() {
            const filterChips = document.querySelectorAll('.filter-chip');
            let currentFilter = '全部季节';
            
            // 添加新的场景筛选选项
            const filterBar = document.querySelector('.filter-bar');
            if (filterBar) {
                // 移除现有的"场景筛选"选项
                const sceneFilter = Array.from(filterChips).find(chip => chip.textContent.trim() === '场景筛选');
                if (sceneFilter) {
                    sceneFilter.remove();
                }
                
                // 添加具体的场景筛选选项
                const sceneFilters = ['日常', '职场', '约会', '运动', '正式', '休闲'];
                sceneFilters.forEach(scene => {
                    const sceneChip = document.createElement('div');
                    sceneChip.className = 'filter-chip';
                    sceneChip.textContent = scene;
                    sceneChip.setAttribute('data-filter-type', 'scene');
                    filterBar.appendChild(sceneChip);
                });
            }
            
            // 为所有筛选选项添加点击事件（包括新添加的）
            const allFilterChips = document.querySelectorAll('.filter-chip');
            allFilterChips.forEach(chip => {
                chip.addEventListener('click', function() {
                    const filterType = this.getAttribute('data-filter-type') || 'season';
                    const filter = this.textContent.trim();
                    
                    // 只移除同类筛选项的active类
                    allFilterChips.forEach(c => {
                        if ((c.getAttribute('data-filter-type') || 'season') === filterType) {
                            c.classList.remove('active');
                        }
                    });
                    
                    // 给当前筛选项添加active类
                    this.classList.add('active');
                    
                    showToast(`${filterType === 'scene' ? '场景' : '季节'}筛选: ${filter}`);
                    
                    // 根据筛选类型调用不同的筛选函数
                    if (filterType === 'scene') {
                        filterByScene(filter);
                    } else {
                        filterBySeason(filter);
                    }
                });
            });
            
            // 标记季节筛选选项
            const seasonFilters = ['全部季节', '春季', '夏季', '秋季', '冬季'];
            allFilterChips.forEach(chip => {
                const text = chip.textContent.trim();
                if (seasonFilters.includes(text)) {
                    chip.setAttribute('data-filter-type', 'season');
                }
            });
        }

        // 初始化查看全部功能
        function initViewAllButtons() {
            console.log("开始初始化查看全部按钮");
            
            // 清除之前可能存在的事件监听器
            document.querySelectorAll('.expanded-content').forEach(item => {
                if(item.parentNode) {
                    item.parentNode.removeChild(item);
                }
            });
            
            // 获取所有查看全部按钮并添加事件监听器
            const viewAllButtons = document.querySelectorAll('.view-all');
            console.log(`找到 ${viewAllButtons.length} 个查看全部按钮`);
            
            viewAllButtons.forEach(button => {
                // 移除可能存在的旧事件监听器
                const newButton = button.cloneNode(true);
                if (button.parentNode) {
                    button.parentNode.replaceChild(newButton, button);
                }
                
                // 添加新的事件监听器
                newButton.addEventListener('click', function(e) {
                    console.log('查看全部按钮被点击');
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // 获取包含此按钮的子分类容器
                    const subcategory = this.closest('.subcategory');
                    if (!subcategory) {
                        console.error('找不到父级子分类容器');
                        return;
                    }
                    
                    // 获取子分类标题
                    const titleEl = subcategory.querySelector('.subcategory-title');
                    const subcategoryTitle = titleEl ? titleEl.textContent.split('查看全部')[0].trim() : '未知子分类';
                    
                    // 检查当前是否已经展开
                    const isExpanded = subcategory.classList.contains('expanded');
                    console.log(`当前状态: ${isExpanded ? '已展开' : '未展开'}, 子分类: ${subcategoryTitle}`);
                    
                    if (isExpanded) {
                        // 收起内容
                        console.log('执行收起操作');
                        this.textContent = '查看全部 >';
                        this.style.color = '';
                        subcategory.classList.remove('expanded');
                        
                        // 隐藏扩展内容
                        const expandedContent = subcategory.querySelector('.expanded-content');
                        if (expandedContent) {
                            expandedContent.style.display = 'none';
                        }
                        
                        showToast(`已收起${subcategoryTitle}`);
                    } else {
                        // 展开内容
                        console.log('执行展开操作');
                        this.textContent = '收起';
                        this.style.color = '#ff7b4e';
                        subcategory.classList.add('expanded');
                        
                        // 获取或创建扩展内容
                        let expandedContent = subcategory.querySelector('.expanded-content');
                        
                        if (!expandedContent) {
                            console.log('创建新的扩展内容');
                            expandedContent = document.createElement('div');
                            expandedContent.className = 'expanded-content';
                            expandedContent.style.display = 'block';
                            
                            // 根据分类获取对应的衣物列表
                            const clothesItems = generateItemsForCategory(subcategoryTitle);
                            
                            // 添加网格容器
                            const grid = document.createElement('div');
                            grid.className = 'expanded-grid';
                            
                            // 向网格中添加衣物
                            clothesItems.forEach(item => {
                                const clothesItem = document.createElement('div');
                                clothesItem.className = 'clothes-item';
                                clothesItem.innerHTML = `
                                    <img src="${item.img}" class="clothes-img" alt="${item.name}">
                                    <div class="item-name">${item.name}</div>
                                `;
                                
                                // 设置数据属性，与筛选逻辑保持一致
                                if (subcategoryTitle.includes('上装')) {
                                    clothesItem.setAttribute('data-category', '上装');
                                } else if (subcategoryTitle.includes('下装')) {
                                    clothesItem.setAttribute('data-category', '下装');
                                }
                                clothesItem.setAttribute('data-season', '春季,夏季,秋季,冬季');
                                clothesItem.setAttribute('data-scene', '日常');
                                
                                // 添加点击事件
                                clothesItem.addEventListener('click', function() {
                                    showToast(`查看衣物: ${item.name}`);
                                });
                                
                                grid.appendChild(clothesItem);
                            });
                            
                            // 将网格添加到扩展内容
                            expandedContent.appendChild(grid);
                            
                            // 将扩展内容添加到子分类
                            subcategory.appendChild(expandedContent);
                        } else {
                            // 如果已存在，显示它
                            expandedContent.style.display = 'block';
                        }
                        
                        showToast(`已展开${subcategoryTitle}`);
                    }
                });
            });
            
            console.log("查看全部按钮初始化完成");
        }
        
        // 根据分类生成对应的衣物数据
        function generateItemsForCategory(categoryTitle) {
            console.log(`为分类 "${categoryTitle}" 生成扩展衣物`);
            
            if (categoryTitle.includes('上装') && categoryTitle.includes('基础款')) {
                return [
                    { name: '白色基础T恤', img: 'https://images.unsplash.com/photo-1576566588028-4147f3842f27?w=387&auto=format&fit=crop' },
                    { name: '黑色休闲卫衣', img: 'https://images.unsplash.com/photo-1598033129183-c4f50c736f10?w=387&auto=format&fit=crop' },
                    { name: '灰色棉质衬衫', img: 'https://images.unsplash.com/photo-1562157873-818bc0726f68?w=387&auto=format&fit=crop' },
                    { name: '条纹长袖T恤', img: 'https://images.unsplash.com/photo-1489987707025-afc232f7ea0f?w=387&auto=format&fit=crop' }
                ];
            } else if (categoryTitle.includes('上装') && categoryTitle.includes('外套')) {
                return [
                    { name: '深蓝色牛仔夹克', img: 'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=387&auto=format&fit=crop' },
                    { name: '黑色皮夹克', img: 'https://images.unsplash.com/photo-1548126032-079a0fb0099d?w=387&auto=format&fit=crop' },
                    { name: '灰色西装外套', img: 'https://images.unsplash.com/photo-1525450824786-227cbef70703?w=387&auto=format&fit=crop' },
                    { name: '米色风衣', img: 'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=387&auto=format&fit=crop' }
                ];
            } else if (categoryTitle.includes('下装') && categoryTitle.includes('裤装')) {
                return [
                    { name: '深蓝色直筒牛仔裤', img: 'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=387&auto=format&fit=crop' },
                    { name: '卡其色休闲裤', img: 'https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=387&auto=format&fit=crop' },
                    { name: '黑色运动裤', img: 'https://images.unsplash.com/photo-1473966968600-fa801b869a1a?w=387&auto=format&fit=crop' },
                    { name: '灰色西装裤', img: 'https://images.unsplash.com/photo-1542272604-787c3835535d?w=387&auto=format&fit=crop' }
                ];
            } else {
                return [
                    { name: '基础服饰1', img: 'https://images.unsplash.com/photo-1562157873-818bc0726f68?w=387&auto=format&fit=crop' },
                    { name: '基础服饰2', img: 'https://images.unsplash.com/photo-1576566588028-4147f3842f27?w=387&auto=format&fit=crop' },
                    { name: '基础服饰3', img: 'https://images.unsplash.com/photo-1598033129183-c4f50c736f10?w=387&auto=format&fit=crop' },
                    { name: '基础服饰4', img: 'https://images.unsplash.com/photo-1525450824786-227cbef70703?w=387&auto=format&fit=crop' }
                ];
            }
        }
        
        // 初始化衣物悬停效果
        function initClothesItemHover() {
            // 为所有衣物项添加悬停效果
            document.querySelectorAll('.clothes-item').forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 3px 8px rgba(0,0,0,0.1)';
                });
                
                item.addEventListener('mouseleave', function() {
                    this.style.transform = '';
                    this.style.boxShadow = '';
                });
            });
        }
    </script>
</body>
</html> 